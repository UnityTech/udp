<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/udp/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/udp/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/udp/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/udp/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/udp/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/udp/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/udp/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Implementing UDP IAP on the client side#To implement UDP IAP, follow these steps:  Configure UDP IAP Initialize UDP SDK Check the payment Purchase a product Consume a purchase Validate the client-sid">
<meta property="og:type" content="website">
<meta property="og:title" content="Unity Distribution Platform">
<meta property="og:url" content="https://unitytech.github.io/udp/Implementing-UDP-IAP-on-the-client-side/index.html">
<meta property="og:site_name" content="Unity Distribution Platform">
<meta property="og:description" content="Implementing UDP IAP on the client side#To implement UDP IAP, follow these steps:  Configure UDP IAP Initialize UDP SDK Check the payment Purchase a product Consume a purchase Validate the client-sid">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://unitytech.github.io/udp/images/IAP-Catalog-updated.png">
<meta property="og:image" content="https://unitytech.github.io/udp/images/GameManager.png">
<meta property="og:image" content="https://unitytech.github.io/udp/images/standalone-game-initialize.png">
<meta property="og:updated_time" content="2018-10-16T06:20:49.674Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity Distribution Platform">
<meta name="twitter:description" content="Implementing UDP IAP on the client side#To implement UDP IAP, follow these steps:  Configure UDP IAP Initialize UDP SDK Check the payment Purchase a product Consume a purchase Validate the client-sid">
<meta name="twitter:image" content="https://unitytech.github.io/udp/images/IAP-Catalog-updated.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/udp/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://unitytech.github.io/udp/Implementing-UDP-IAP-on-the-client-side/"/>





  <title> | Unity Distribution Platform</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/udp/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Unity Distribution Platform</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/udp/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/udp/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-quick-guide">
          <a href="/udp/Quick-Guide/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            Quick Guide
          </a>
        </li>
      
        
        <li class="menu-item menu-item-document">
          <a href="/udp/UDP-Guide/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            Document
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

	<h1 class="post-title" itemprop="name headline"></h1>



</header>

      
      
      
      <div class="post-body">
        
        
          <p><br></p>
<h2><span id="implementing-udp-iap-on-the-client-side">Implementing UDP IAP on the client side</span><a href="#implementing-udp-iap-on-the-client-side" class="header-anchor">#</a></h2><p>To implement UDP IAP, follow these steps:</p>
<ul>
<li>Configure UDP IAP</li>
<li>Initialize UDP SDK</li>
<li>Check the payment</li>
<li>Purchase a product</li>
<li>Consume a purchase</li>
<li>Validate the client-side integration</li>
</ul>
<h3><span id="configuring-udp-iap">Configuring UDP IAP</span><a href="#configuring-udp-iap" class="header-anchor">#</a></h3><p>Take the following steps to configure UDP IAP:</p>
<ol>
<li><p>Choose <code>IAP Catalog</code> (<code>Window</code> &gt; <code>Unity UDP</code> &gt; <code>IAP Catalog</code>). </p>
</li>
<li><p>Input your product information and click <code>Create Product</code> to sync with the server. To add more products, Click <code>Add Product Draft</code>.<br><div> Note: Specify the product price, or players can’t purchase products in game stores.</div></p>
<!-- ![](images/IAP-Catalog.png) -->
<p><img src="../images/IAP-Catalog-updated.png" width="500px"></p>
 
</li>
<li><p>Click the <code>GameManager</code> GameObject in <code>Hierarchy</code> and enter the slugs of your products into <code>Product_1</code> and <code>Product_2</code>. You can add more products using the <code>GameManager.cs</code> file.</p>
<!-- ![](images/GameManager.png) -->
<p><img src="../images/GameManager.png" width="400px"></p>
 
</li>
</ol>
<h3><span id="initializing-udp-sdk">Initializing UDP SDK</span><a href="#initializing-udp-sdk" class="header-anchor">#</a></h3><p>To initialize UDP SDK, your game provides the Unity client ID and Unity client key to the UDP SDK. The initialization listener will let you know whether the initialization succeeds by returning a success or failure message.</p>
<p><img src="../images/standalone-game-initialize.png" width="300px"></p>
<p>Call the <code>Initialize</code> method with <code>IInitCallback</code> and <code>AppInfo</code>.<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StoreService.Initialize(IInitCallback, AppInfo)</span><br></pre></td></tr></table></figure></p>
<p>Note that you don’t need to send AppInfo if you have configured the GameSetting file in the Unity Editor.</p>
<p>Then <code>InitListener</code> will notify your game whether the initialization succeeds.<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InitCallback</span> : <span class="title">IInitListener</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnInitialized</span>(<span class="params">UserInfo userInfo</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Debug.Log(<span class="string">"Initialization succeeded"</span>);</span><br><span class="line">        <span class="comment">// Developers can call queryInventory here</span></span><br><span class="line">        <span class="comment">// to see if there are purchases needed to be consumed        </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnInitializeFailed</span>(<span class="params"><span class="keyword">string</span> message</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Debug.Log(<span class="string">"Initialization failed: "</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3><span id="checking-the-payment">Checking the payment</span><a href="#checking-the-payment" class="header-anchor">#</a></h3><p>To prevent a product being paid for but not delivered, your game needs to query the partner stores’ inventory after the initialization is completed. This allows you to, for example, restore non-consumable products when your game is reinstalled.</p>
<p>Your game checks whether there is an unconsumed product by calling the QueryInventory method immediately after the initialization succeeds.</p>
<p>In you game, you can query the item details with <code>QueryInventort</code>. If you specify <code>productIds</code>, you can get the information of your specified items. If you don’t specify <code>productIdS</code>, you can get the information of all items that are purchased but not consumed.  </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PurchaseService.QueryInventory(productIds, callback);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">PurchaseService.QueryInventory(callback);</span><br><span class="line"><span class="comment">// or</span></span><br></pre></td></tr></table></figure>
<div> Note: Call this method after a successful initialization. This step can prevent the situation where an item is purchased but not delivered to the player for some reason, such as an application crash.</div>

<p><em> Implementing listeners for events that are related to the purchase service </em></p>
<p><code>IPurchaseListener</code> provides the following listeners that tell you the result of all purchase-related events:</p>
<ul>
<li><code>OnPurchase</code> tells you that the purchase succeeded. </li>
<li><code>OnPurchaseFailed</code> tells you that the purchase failed. </li>
<li><code>OnPurchaseRepeated</code> is used when a player buys a non-consumable product several times. You can implement this listener when the partner store doesn’t support <code>QueryInventory</code>. </li>
<li><code>OnPurchaseConsume</code> tells you that the consumption succeeded.</li>
<li><code>OnPurchaseConsumeFailed</code> tells you that the consumption failed. </li>
<li><code>OnQueryInventory</code> tells you that the querying succeeded. </li>
<li><code>OnQueryInventoryFailed</code> tell you that the query failed. </li>
</ul>
<p>Here is an example:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PurchaseCallback</span> : <span class="title">IPurchaseListener</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPurchase</span>(<span class="params">PurchaseInfo purchaseInfo</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// The purchase has succeeded.</span></span><br><span class="line">        <span class="comment">// If the purchased item is consumable, you should consume it here.</span></span><br><span class="line">        <span class="comment">// Otherwise, deliver the product.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPurchaseFailed</span>(<span class="params"><span class="keyword">string</span> message, PurchaseInfo purchaseInfo</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Debug.Log(<span class="string">"Purchase Failed: "</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPurchaseRepeated</span>(<span class="params"><span class="keyword">string</span> productCode</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Some stores don't support queryInventory,</span></span><br><span class="line">        <span class="comment">// when buying non-consumable products repeatedly,</span></span><br><span class="line">        <span class="comment">// This listener will be triggered.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPurchaseConsume</span>(<span class="params">PurchaseInfo purchaseInfo</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// The consumption succeeded.</span></span><br><span class="line">        <span class="comment">// You should deliver the product here.        </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPurchaseConsumeFailed</span>(<span class="params"><span class="keyword">string</span> message, PurchaseInfo purchaseInfo</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// The consumption failed.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnQueryInventory</span>(<span class="params">Inventory inventory</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Querying inventory succeeded.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnQueryInventoryFailed</span>(<span class="params"><span class="keyword">string</span> message</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Querying inventory failed.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="purchasing-an-item">Purchasing an item</span><a href="#purchasing-an-item" class="header-anchor">#</a></h3><p>To start a purchase request from your game, call the <code>Purchase</code> method and provide <code>productId</code>, <code>cpOrderId</code>, and <code>developerPayload</code>.<br><code>productId</code> is the product that the player wants to buy. <code>cpOrderId</code> is a unique order ID defined by yourself. If you provide a null for this argument, the SDK for UDP will generate a UUID automatically.  <code>developerPayload</code> is whatever information you want to send to the SDK for UDP. The information will be returned after the purchase is completed.</p>
<p>Here is an example:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PurchaseService.Purchase(<span class="string">"productId"</span>, <span class="string">"cpOrderId"</span>, <span class="string">"developerPayload"</span>, PurchaseCallback);</span><br></pre></td></tr></table></figure>
<h3><span id="consuming-a-purchase">Consuming a purchase</span><a href="#consuming-a-purchase" class="header-anchor">#</a></h3><p>If a consumable product is purchased, it can’t be repurchased again before it has been consumed. So the consumption is used to make sure the purchased product is successfully delivered. </p>
<p>Note: This step is only necessary when the product is consumable.</p>
<p>Your game sends a <code>Consume</code> request to UDP SDK. We recommend that your game delivers the product after it has been consumed, or the product may be delivered repeatedly.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PurchaseService.ConsumePurchase(PurchaseInfo, IPurchaseListener);</span><br></pre></td></tr></table></figure>
<p><code>PurchaseInfo</code> is returned by <code>OnPurchase</code>.</p>
<h3><span id="validating-the-client-side-integration">Validating the client-side integration</span><a href="#validating-the-client-side-integration" class="header-anchor">#</a></h3><p>UDP performs client-side validations automatically. When partner stores return the payload and signature after a successful purchase, UDP SDK validates the signature. If the validation fails, the purchase fails accordingly.</p>

        
      </div>
      
      
      
    </div>
    
    
    
  </div>


          </div>
          


          
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Unity Technology</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/udp/archives/">
              
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Unity Technology</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/udp/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/udp/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/udp/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/udp/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/udp/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/udp/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/udp/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/udp/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/udp/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/udp/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/udp/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
